<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Trap Scorecard PWA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 12px;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        .info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 10px;
        }

        .info div {
            background: white;
            padding: 10px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }

        select {
            font-size: 18px;
            padding: 8px;
            width: 100%;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            background: white;
        }

        th,
        td {
            border: 1px solid #ccc;
            text-align: center;
        }

        th {
            background: #2f6f4e;
            color: white;
            font-size: 14px;
            padding: 6px;
        }

        .name {
            width: 110px;
            font-weight: bold;
            background: #eef2f4;
        }

        .shot {
            width: 48px;
            height: 48px;
            font-size: 24px;
            font-weight: bold;
            user-select: none;
        }

        .shot.hit {
            background: #c8f3d1;
        }

        .shot.miss {
            background: #f7c6c6;
        }

        .total {
            width: 55px;
            font-weight: bold;
            background: #eef2f4;
            font-size: 18px;
        }

        .sep-right {
            border-right: 3px double #444;
        }

        .controls {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
        }

        button {
            font-size: 18px;
            padding: 10px 16px;
            border-radius: 10px;
            border: none;
            background: #2f6f4e;
            color: white;
        }
    </style>
</head>

<body>

    <h1>Trap Scorecard</h1>

    <div class="info">
        <div>
            Squad:<br>
            <select id="squadSelect" onchange="onSquadChange()"></select>
        </div>
        <div>
            Trap:<br>
            <span id="trapNum"></span>
        </div>
        <div>
            Date:<br>
            <span id="dateVal"></span>
        </div>
        <div>
            Time:<br>
            <span id="timeVal"></span>
        </div>
    </div>

    <table id="scoreTable"></table>

    <div class="controls">
        <button onclick="resetScores()">Reset</button>
        <button onclick="clearStorage()">Clear Storage</button>
    </div>

    <script>
        const shotsPerRound = 25;

        const squads = [
            {
                "squadName": "Squad A",
                "trapNumber": 1,
                "date": "2026-01-25",
                "time": "09:00",
                "shooters": ["John P.", "Mike R.", "Tom S.", "Ben L.", "Chris D."]
            },
            {
                "squadName": "Squad B",
                "trapNumber": 2,
                "date": "2026-01-25",
                "time": "09:15",
                "shooters": ["Alice K.", "Bob T.", "Charlie H.", "Dana M.", "Evan S."]
            },
            {
                "squadName": "Squad C",
                "trapNumber": 3,
                "date": "2026-01-25",
                "time": "09:30",
                "shooters": ["Frank W.", "Grace L.", "Hank R.", "Ivy N.", "Jack P."]
            },
            {
                "squadName": "Squad D",
                "trapNumber": 4,
                "date": "2026-01-25",
                "time": "09:45",
                "shooters": ["Kara J.", "Liam B.", "Mia V.", "Noah K.", "Olivia C."]
            },
            {
                "squadName": "Squad E",
                "trapNumber": 5,
                "date": "2026-01-25",
                "time": "10:00",
                "shooters": ["Paul G.", "Quinn R.", "Rita S.", "Sam D.", "Tina F."]
            },
            {
                "squadName": "Squad F",
                "trapNumber": 6,
                "date": "2026-01-25",
                "time": "10:15",
                "shooters": ["Ulysses W.", "Vera M.", "Walt H.", "Xena Z.", "Yuri P."]
            }
        ];

        let currentSquadIndex = 0;
        let scores = {};

        function loadScores() {
            try {
                const stored = localStorage.getItem("scores");
                scores = stored ? JSON.parse(stored) : {};
            } catch (e) {
                scores = {};
            }
        }

        function saveScores() {
            localStorage.setItem("scores", JSON.stringify(scores));
        }

        function getSquadKey() {
            return squads[currentSquadIndex]?.squadName || "default";
        }

        function buildTable() {
            const table = document.getElementById("scoreTable");
            table.innerHTML = "";

            const squad = squads[currentSquadIndex];
            const key = getSquadKey();

            if (!scores[key]) {
                scores[key] = {};
                squad.shooters.forEach(name => {
                    scores[key][name] = Array(shotsPerRound).fill("");
                });
            }

            let header = "<tr><th>Shooter</th>";
            for (let i = 1; i <= shotsPerRound; i++) {
                const sepClass = isSeparator(i) ? "sep-right" : "";
                header += `<th class="${sepClass}">${i}</th>`;
            }
            header += "<th class='sep-right'>Total</th></tr>";
            table.innerHTML += header;

            squad.shooters.forEach(name => {
                let row = `<tr><td class="name">${name}</td>`;
                scores[key][name].forEach((val, idx) => {
                    const sepClass = isSeparator(idx + 1) ? "sep-right" : "";
                    row += `<td class="shot ${classFor(val)} ${sepClass}"
                     onclick="cycle('${name}', ${idx})">${val}</td>`;
                });
                row += `<td class="total sep-right">${countHits(scores[key][name])}</td></tr>`;
                table.innerHTML += row;
            });

            saveScores();
        }

        function isSeparator(col) {
            return col === 5 || col === 10 || col === 15 || col === 20 || col === 25;
        }

        function cycle(name, index) {
            const key = getSquadKey();
            const current = scores[key][name][index];
            if (current === "") scores[key][name][index] = "X";
            else if (current === "X") scores[key][name][index] = "O";
            else scores[key][name][index] = "";

            saveScores();
            buildTable();
        }

        function countHits(row) {
            return row.filter(v => v === "X").length;
        }

        function classFor(val) {
            if (val === "X") return "hit";
            if (val === "O") return "miss";
            return "";
        }

        function resetScores() {
            const key = getSquadKey();
            const squad = squads[currentSquadIndex];
            squad.shooters.forEach(name => {
                scores[key][name] = Array(shotsPerRound).fill("");
            });
            saveScores();
            buildTable();
        }

        function clearStorage() {
            localStorage.removeItem("scores");
            scores = {};
            buildTable();
        }

        function populateSquadSelect() {
            const select = document.getElementById("squadSelect");
            select.innerHTML = "";
            squads.forEach((s, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.text = s.squadName;
                select.appendChild(option);
            });
        }

        function updateInfo() {
            const squad = squads[currentSquadIndex];
            document.getElementById("trapNum").textContent = squad.trapNumber;
            document.getElementById("dateVal").textContent = squad.date;
            document.getElementById("timeVal").textContent = squad.time;
        }

        function onSquadChange() {
            currentSquadIndex = parseInt(document.getElementById("squadSelect").value);
            updateInfo();
            buildTable();
        }

        function init() {
            populateSquadSelect();
            updateInfo();
            loadScores();
            buildTable();
        }

        init();
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>

</body>

</html>